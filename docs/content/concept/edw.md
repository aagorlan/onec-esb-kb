---
title: "Хранилище данных"
date: 2023-07-11
weight: 30
---

[Термины и определения]({{< ref "/terms" >}})

## Что такое хранилище данных

Корпоративное хранилище данных – это специальным образом организованный массив данных предприятия (организации), обрабатываемый и хранящийся в едином аппаратно-программном комплексе, который обеспечивает быстрый доступ к оперативной и исторической информации, многомерный анализ данных , получение прогнозов и статистики в разрезах согласованной нормативно-справочной информации.

> Информация с сайта:\
<https://www.prj-exp.ru/dwh/what_is_dwh.php>

## Реализация работы с хранилищем данных

Для реализации онтологической модели используются графовые базы данных, такие как HyperGraphDB — модель мультиграфа, ArangoDB и OrientDB — мультимодельные СУБД, GraphX — распределенный фреймворк для работы с графами в экосистеме Hadoop, использующий вычислительный механизм Spark.

СУБД подключается к ЕСД через HTTP REST интерфейс. Модульная структура ЕСД позволяет подключать произвольную СУБД, для подключения необходимо добавить соответствующий интерфейс.

Экземпляры объектов хранятся в виде документов в формате json в документных/комбинированных СУБД, связи между объектами хранятся в виде графов в графовых/комбинированных СУБД.

Корректировка модели данных приводит к изменению структуры базы данных, каждому объекту или типу связи соответствует отдельная коллекция в базе данных.

Контроль корректности и соответствие модели данных производится на уровне ЕСД.

Версионирование данных и управление версиями производится на уровне ЕСД, путем записи в базу данных служебных полей, содержащих ссылки на предыдущие версии одного и того же объекта и фиксации временной метки создания версии. Инициация очистки данных устаревших версий объектов производится на уровне ЕСД.

### Добавление, изменение и контроль данных из информационных систем

Для добавления или изменения данных в ХД используются пакеты, проходящие через ЕСД с командой PUT.
При поступлении пакета, до маршрутизации пакета в другие ИР, в соответствии с настройками интеграций, производится поиск данных в ХД:

1. производится выделение ключевых полей, в соответствии с текущей схемой;
2. запрос к ХД информации об объекте по ключевым полям;
3. если по ключевым полям объект не найден, производится поиск по идентификатору, при его наличии;
4. если информация об объекте имеется в ХД производится добавление объекта, иначе обновление данных объекта.

При добавлении объекта:

1. проверяется право ИС источника на добавление данных в коллекцию;
2. проверяется наличие обязательных свойств в данных объекта;
3. проверяется наличие указания на обязательные связи в данных объекта;
4. проверяется право создания всех связей, указанных в данных;
5. объект добавляется в хранилище со всеми данными, переданными в пакете;
6. добавляются связи между созданным объектом и описанными связями с другими объектами.

Если идентификатор объекта не указан в данных пакета, то он генерируется автоматически и подставляется в пакет перед дальнейшей маршрутизацией пакета в другие ИР.
При обновлении данных пакета:

1. проверяется какие данные в пакете были изменены, если были изменены ключевые поля, проверяется право добавления объекта;
2. проверяются права на изменение данных для ИС источника;
3. фиксируется версия текущего объекта;
4. записываются изменения в данные текущего объекта.

В пакет устанавливается найденный идентификатор объекта независимо от его указания в исходных данных
В случае возникновения ошибки при записи или недостаточности прав, данные объекта и информация об ошибке сохраняется в лог работы с ХД.

### Хранение истории версий объектов и связей

Для каждого объекта в базе данных поддерживается история изменения объекта, учитывающая дату начала актуальности версии объекта, дату потери актуальности версии объекта (для актуального состояния пустая). При изменении свойств объекта копия актуального объекта сохраняется как не актуальная с установкой даты потери актуальности. Данные актуального объекта перезаписываются с изменением даты начала актуальности. Сохраненные версии объекта хранятся до достижения установленного для объекта порога хранимых версий в количестве версий (по умолчанию 5) или дней (по умолчанию 30), версии старше установленного порога удаляются.

### Удаление объектов и связей

Для удаления данных в ХД используются пакеты, проходящие через ЕСД с командой DELETE. Указанный в таком пакете объект помечается как неактуальный, устанавливается дата потери актуальности. Все связи этого объекта с другими объектами так же помечаются как неактуальные.

Предусмотрен пакет для удаления произвольной связи, отправляемый в ЕСД с командой DELETE, при получении которого, конкретная связь помечается как неактуальная.
Все неактуальные объекты (вместе со всеми версиями) и связи удаляются из базы данных через задаваемое в установках время (по умолчанию 30 дней).

### Получение информации об актуальном состоянии объекта и/или о хранящихся предыдущих версиях объекта

Для получения данных из ХД используются пакеты с командой GET или GETFULL.
Для запроса данных объекта в структуре запроса должны быть заполнены ключевые свойства и/или идентификатор объекта. В случае, когда заполнены и ключевые свойства, и идентификатор, поиск объекта в ХД осуществляется сначала по идентификатору, затем по ключевым свойствам.
Команда GETFULL возвращает все объекты, хранящиеся версии и связи независимо от признака актуальности (в выборку попадают неактуальные объекты, сохраненные ранее версии и неактуальные связи). Команда GET возвращает полные данные актуального объекта и все актуальные связи этого объекта, где он является источником связи. При отсутствии объекта в ХД, возвращается пакет с ошибкой.

### Передача данных без взаимодействия с ХД

Часть объектов, хранение которых не предполагается в ХД, но их передача между системами необходима с модели данных помечаются как не хранимые, а передача через ЕСД производится с командой TRANSFER.

### Передача нескольких объектов в одном пакете

Структура пакета передачи данных в ЕСД предусматривает передачу нескольких объектов в одном пакете данных. Обработка данного пакета данных в ЕСД производится отдельными пакетами параллельно и независимо друг от друга.
