---
title: "Библиотека работы с git"
date: 2023-07-20
author: "aagorlan"
tags: ["Git"]
slug: "git"
description: "Требования по реализации библиотеки взаимодействия git и 1С"
---

{{< toc >}}

## Настройка репозитория

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
Данные для подключения к репозиторию (путь, имя пользователя, пароль)

**Исходящие данные**
Настройка, сохранённая в справочнике

**Исполнитель**
Полные права

**Описание реализуемых задач**
Добавление в справочник "Git: Настройки репозиториев" новой записи. Для каждой настройки фиксируется способ авторизации (без авторизации, пароль или OAuth). В зависимости от способа авторизации запрашивается и контролируется ввод информации для авторизации. Данные авторизации должны храниться в защищенном хранилище (функцию защищенного хранилища необходимо перенести из БСП).

В модуле менеджера необходимо сделать функцию получения полной строки соединения с авторизацией:

- без авторизации (https://<адрес репозитория>.git);
- логином и паролем (https://<логин>:<пароль>@<адрес репозитория>.git);
- OAuth (https://<токен>:x-oauth-basic@<адрес репозитория>.git).

**Модель данных**
Справочник "Настройки репозиториев Git" (новый)\
*Реквизиты*

- Путь к репозиторию
- Путь локального хранения (относительно сервера 1С)
- Способ авторизации

## Подключение к удаленному репозиторию

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Ссылка на настройку репозитория*, *Имя ветки*, *Локальное расположение*

**Исходящие данные**
Признак успешного выполнения клонирования репозитория и последующего переключения на ветку

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Для подключения к удаленному репозиторию необходимо:

- Получить из настройки репозитория, данные для подключения к удаленному репозиторию;
- Клонировать удаленный репозиторий в локальный, для хранения используется переданное локальное расположение (git clone);
- Подключение завершается переключением на ветку с созданием, если она отсутствует (git checkout -B <имя ветки> staging).

**Модель данных**
Не требуется

## Проверка наличия изменений файлов

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*

**Исходящие данные**
Наличие изменений (Булево), массивы добавленных, изменённых и удалённых файлов

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Проверяет наличие неиндексированных изменений файлов в рабочем каталоге (git diff, git status). Возвращает «Истина», если  изменения обнаружены, и «Ложь», если изменений не было. Опционально возвращает массивы с именами файлов с изменениями.

## Индексирование файлов

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*

**Исходящие данные**
Изменённые файлы добавлены в индекс локального репозитория

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Индексирует содержимое локального каталога (git add -A)

## Создание коммита

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*, *Сообщение коммита*

**Исходящие данные**
Информация об успешности создания коммита, тексты ответа и ошибок Git

**Исполнитель**
Пользователь, имеющий роль "Архитектор данных"

**Описание реализуемых задач**
Собирает коммит для указанной ветки из проиндексированных файлов с переданным сообщением (git commit –m).
Отправляет изменения на сервер (git push)

## Перебазирование

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Идентификатор перебазируемого коммита*, *Идентификатор коммита-базы*, *Локальное расположение*

**Исходящие данные**
Информация об успешности перебазирования, тексты ответа и ошибок Git

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Производит процедуру перебазирования: перемещает ветку, начиная с перебазируемого коммита, закрепляя её после коммита-базы (git rebase).

## Слияние веток

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Имя сливаемой ветки*, *Имя целевой ветки*, *Локальное расположение*

**Исходящие данные**
Информация об успешности слияния, тексты ответа и ошибок Git

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Производит явное слияние сливаемой ветки в целевую (git merge). Результатом слияния является новый коммит. В случае остановки процедуры возвращает ошибку.

## Удаление ветки

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Имя ветки*, *Локальное расположение*, *Признак удаления внешней ветки*

**Исходящие данные**
Информация об успешности удаления

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Производит удаление ветки на сервере (push origin --delete) или в локальном репозитории (branch -D).

## Вызов информационных и управляющих функций Git

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*

**Исходящие данные**
Информационное сообщение или признак успешности выполнения

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Реализация вспомогательных функций Git, предназначенных для работы основных функций, включает:

- Получение имени текущей ветки;
- Получение индекса текущего коммита;
- Переключение на ветку (без создания в случае отсутствия);
- Получение данных из удалённого репозитория;
- Отправка данных в удалённый репозиторий (с параметрами команды и без).

Для функций обеспечивается возможность независимого вызова из других модулей.
