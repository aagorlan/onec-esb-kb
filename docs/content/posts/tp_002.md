---
title: "Библиотека работы с git"
date: 2023-07-20
author: "aagorlan"
tags: ["Git"]
description: "Требования по реализации библиотеки взаимодействия git и 1С"
---

{{< toc >}}

## Настройка репозитория

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
Данные для подключения к репозиторию (путь, имя пользователя, пароль)

**Исходящие данные**
Ссылка на сохраненную настройку, строка подключения к репозиторию

**Исполнитель**
Полные права

**Описание реализуемых задач**
Добавление в справочник "Настройки репозиториев Git" новой записи. Для каждой настройки фиксируется способ авторизации (без авторизации, пароль или OAuth). В зависимости от способа авторизации запрашивается и контролируется ввод информации для авторизации. Данные авторизации должны храниться в защищенном хранилище (функцию защищенного хранилища необходимо перенести из БСП).

В модуле менеджера необходимо сделать функцию получения полной строки соединения с авторизацией:

- без авторизации (https://<адрес репозитория>.git);
- логином и паролем (https://<логин>:<пароль>@<адрес репозитория>.git);
- OAuth (https://<токен>:x-oauth-basic@<адрес репозитория>.git).

**Модель данных**
Справочник "Настройки репозиториев Git" (новый)\
*Реквизиты*

- Путь к репозиторию
- Путь локального хранения (относительно сервера 1С)
- Способ авторизации

## Подключение к удаленному репозиторию

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Ссылка на настройку репозитория*, *Имя ветки*, *Локальное расположение*

**Исходящие данные**
Индекс текущего коммита для выбранного контура

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Для подключения к удаленному репозиторию необходимо:

- Получить из настройки репозитория, данные для подключения к удаленному репозиторию;
- Клонировать удаленный репозиторий в локальный, для хранения используется переданное локальное расположение (git clone);
- Подключение завершается переключением на ветку с созданием, если она отсутствует (git checkout -B <имя ветки> staging).

**Модель данных**
Не требуется

## Проверка наличия изменений файлов

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*

**Исходящие данные**
Булево (Наличие изменений)

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Проверяет наличие неиндексированных изменений файлов в рабочем каталоге (git diff). Возвращает «Истина», если  изменения обнаружены, и «Ложь», если изменений не было.

## Индексирование файлов

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*

**Исходящие данные**
Изменённые файлы добавлены в индекс локального репозитория

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Индексирует содержимое локального каталога (git add -A)

## Создание коммита

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Локальное расположение*, *Сообщение коммита*

**Исходящие данные**
Индекс коммита

**Исполнитель**
Пользователь, имеющий роль "Архитектор данных"

**Описание реализуемых задач**
Собирает коммит для указанной ветки из проиндексированных файлов с переданным сообщением (git commit –m).
Отправляет изменения на сервер (git push)

## Перебазирование

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Идентификатор перебазируемого коммита*, *Идентификатор коммита-базы*, *Локальное расположение*

**Исходящие данные**
Отсутствуют

**Исполнитель**
Архитектор данных

**Описание реализуемых задач**
Производит процедуру перебазирования: перемещает ветку, начиная с перебазируемого коммита, закрепляя её после коммита-базы (git rebase --onto).

## Слияние веток

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Имя сливаемой ветки*, *Имя целевой ветки*, *Локальное расположение*

**Исходящие данные**
Индекс коммита или сообщение об ошибке

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Производит явное слияние сливаемой ветки в целевую (git merge –no--ff). Результатом слияния является новый коммит. В случае остановки процедуры возвращает ошибку.

## Удаление ветки

**Особенности объекта управления, влияющие на проектные решения по функции**
Не выявлено

**Входящие данные**
*Имя ветки*, *Локальное расположение*

**Исходящие данные**
Отсутствуют

**Исполнитель**
Архитектор интеграций

**Описание реализуемых задач**
Производит удаление ветки на сервере (git push origin --delete) и удаляет локальную папка, переданную в качестве локального расположения.
